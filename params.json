{"name":"Islandora usage stats","tagline":"Track views of islandora items, show most popular items, and recent activity","body":"Islandora Usage Stats\r\n=====================\r\n\r\nA simple module for Drupal 7 to track views of islandora items in the Ryerson Digital Repository.\r\n\r\nWork based on code from https://github.com/roblib/islandora_scholar_upei and the scholar_tracking module for Drupal 6.\r\n\r\n![Most Popular Items](http://library.ryerson.ca/wp-content/uploads/MostPopularScreenshot.jpg)\r\n![Recent Activity](http://library.ryerson.ca/wp-content/uploads/RecentActivityScreenshot.jpg)\r\n![View of module in action](http://library.ryerson.ca/wp-content/uploads/ViewsDownloadsScreenshot.jpg)\r\n\r\n##Features\r\n- View count uses session variables and defaults to a 5 minute cooldown for repeated requests\r\n- Tracks views of all types of objects in the repository\r\n- Access log for all views and downloads, can be disabled\r\n- IP Exclusion list to prevent artifically inflating counts while testing/developing\r\n- Drupal hook to allow other modules to fire events based on datastream download (hook_islandora_datastream_download)\r\n- Custom block to display most viewed items\r\n- Permissions to view usage data on an item page\r\n- Permissions to view most popular items block\r\n\r\n##Variables available:\r\n- **times_viewed:** How many times the item has been viewed\r\n- **time_last_viewed:** The datetime of the last recorded view in seconds since the unix epoch, format with a call to date()\r\n- **times_downloaded:** How many times the item has been downloaded\r\n- **time_last_downloaded:**  The datetime of the last download in seconds since the unix epoch, format with a call to date()\r\n- *islandora_download_link:* Altered for the Islandora PDF module only. Redirects the download request to allow tracking of PDF downloads\r\n\r\n##How to use:\r\n- Place the downloaded module in your sites/all/modules folder and enable it\r\n- Configure any excluded IP addresses under Admin > Config > Islandora Usage Stats\r\n- Make sure user permissions are set appropriately under People > Permissions\r\n- Edit your site theme file to output the stats where you want them\r\n- *Optional*: use the hook_islandora_datastream_download to add functionality based on a datastream download\r\n\r\n\r\n##How to display tracking data on your template files:\r\n- In order to display tracking data for Islandora objects we need to modify your site's theme files\r\n- Add a function with the naming convention ```islandora_usage_stats_preprocess_yourTemplateFileName``` at the end of the islandora_usage_stats.module file (and replace ```yourTemplateFileName``` with the name of a template you want to override).\r\n  - The function ```islandora_usage_stats_preprocess_islandora_pdf``` included in the ```islandora_usage_stats.module``` file can be used as an example and should be duplicated and renamed to affect other templates\r\n- Copy the template file you want to override to your theme's ```templates``` directory and follow the example below to display tracking information\r\n\r\n##An example:\r\nWe will add view and download stats to items in our Islandora PDF collection\r\n###Step 1\r\nNavigate to your Drupal site's modules directory and clone the latest version of the module\r\n\r\n```$ cd <your_Drupal_Site>/sites/all/modules```\r\n\r\n```$ git clone https://github.com/ryersonlibrary/islandora_usage_stats```\r\n\r\n###Step 2\r\nOpen the ```islandora_usage_stats.module``` file in a text editor and create/edit the template preprocess function necessary to modify the Islandora PDF collection\r\n\r\n```$ vim islandora_usage_stats/islandora_usage_stats.module```\r\n\r\nThe template preprocess function follows the naming convention of ```islandora_usage_stats_preprocess_MODULE_NAME(&$variables)``` so make sure to edit yours accordingly\r\n\r\n```php\r\nfunction islandora_usage_stats_preprocess_islandora_pdf($&variables)\r\n{\r\n  $islandora_object = $variables['islandora_object'];\r\n  $id = $islandora_object->id;\r\n  $label = $islandora_object->label;\r\n  \r\n  $track = new IslandoraUsageStats($id);\r\n  $variables['time_last_viewed'] = $track->getLastViewedTime();\r\n  \r\n  $currentStats = $track->getViewCount();\r\n  $variables['times_viewed'] = $currentStats['views'];\r\n  \r\n  $downloaded = $track->getDownloads('OBJ');\r\n  \r\n  $variables['times_downloaded'] = $downloaded['downloads'];\r\n  $variables['time_last_downloaded'] = $downloaded['time'];\r\n  \r\n  // we have added some bootstrap specific css classes and glyphicons to our link, include if desired\r\n  $variables['islandora_download_link'] = l('<i class=\"glyphicon glyphicon-download\"> ' . t('Download PDF') . '</i>', 'download_ds/' . $id . '/OBJ/' . $label, array(\r\n    'attributes' => array(\r\n          'class' => 'btn btn-primary'\r\n      ),\r\n      'html' => TRUE,\r\n  ));\r\n}\r\n\r\n```\r\n###Step 3\r\nNavigate to your site's themes directory and copy the Islandora PDF template file so we can make changes to it and override it\r\n\r\n```$ cd <your_Drupal_Site>/sites/themes/<yourtheme>```\r\n\r\n```$ cp <your_Drupal_Site>/sites/all/islandora_solution_pack_pdf/theme/islandora-pdf.tpl.php .```\r\n\r\n###Step 4\r\nEdit the copied template file to output our new tracking variables \r\n####Before\r\n**/var/www/your_Drupal_Site/sites/themes/your_Theme/islandora-pdf.tpl.php**\r\n```html\r\n<!------- SNIP ---------->\r\n<div class=\"islandora-pdf-content-wrapper clearfix\">\r\n<?php if (isset($islandora_content)): ?>\r\n  \r\n  <div class=\"islandora-pdf-content\">\r\n    <?php print $islandora_content; ?>\r\n  </div>\r\n  \r\n  <?php if (isset($islandora_download_link)): ?>\r\n  <div class=\"islandora-download-link\">\r\n    <?php print $islandora_download_link; ?>\r\n  </div>\r\n  <?php endif; ?>\r\n  \r\n<?php endif; ?>\r\n</div>\r\n```\r\n\r\n####After\r\n**/var/www/your_Drupal_Site/sites/themes/your_Theme/islandora-pdf.tpl.php**\r\n```html\r\n<!------- SNIP ---------->\r\n<div class=\"islandora-pdf-content-wrapper clearfix\">\r\n<?php if (isset($islandora_content)): ?>\r\n  \r\n  <div class=\"islandora-pdf-content\">\r\n    <?php print $islandora_content; ?>\r\n  </div>\r\n  \r\n  <?php if (isset($islandora_download_link)): ?>\r\n  <div class=\"islandora-download-link\">\r\n    <?php print $islandora_download_link; ?>\r\n  </div>\r\n  <?php endif; ?>\r\n  \r\n<?php endif; ?>\r\n</div>\r\n\r\n<!-- usage stats -->\r\n<?php if (module_exists('islandora_usage_stats')): ?>\r\n<div class=\"islandora-usage-stats\">\r\n  <!-- we have added some bootstrap specific css classes (badge) to our view counts, include if desired -->\r\n  <p>\r\n    Viewed: <span class=\"badge\"><?php print $times_viewed ?></span> Last viewed: <?php print $time_last_viewed==NULL ? 'Never' : date('g:ia, M d, Y', $time_last_viewed); ?>\r\n  </p>\r\n  <p>\r\n    Downloaded: <span class=\"badge\"><?php print $times_downloaded ?></span> Last downloaded: <?php print $time_last_downloaded==NULL ? 'Never' : date('g:ia, M d, Y', $time_last_downloaded); ?>\r\n  </p>\r\n</div>\r\n<?php endif; ?>\r\n<!-- end usage stats -->\r\n```\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}